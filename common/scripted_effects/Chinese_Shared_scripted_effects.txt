purge_LEP_templates = {
	if = {
		limit = { has_template = "Qibing Xie" }
		delete_unit_template_and_units = { division_template = "Qibing Xie" }
	}
	if = {
		limit = { has_template = "Bubing Xie" }
		delete_unit_template_and_units = { division_template = "Bubing Xie" }
	}
	if = {
		limit = { has_template = "Bubing Zhen" }
		delete_unit_template_and_units = { division_template = "Bubing Zhen" }
	}
	if = {
		limit = { has_template = "Paobing Zhen" }
		delete_unit_template_and_units = { division_template = "Paobing Zhen" }
	}
	if = {
		limit = { has_template = "Motorized-Division" }
		delete_unit_template_and_units = { division_template = "Motorized-Division" }
	}
}

purge_AI_templates = {
	if = {
		limit = { has_template = "Armored-Division" }
		delete_unit_template_and_units = { division_template = "Armored-Division" }
	}
	if = {
		limit = { has_template = "Mountaineer-Division" }
		delete_unit_template_and_units = { division_template = "Mountaineer-Division" }
	}
	if = {
		limit = { has_template = "Garrison Division" }
		delete_unit_template_and_units = { division_template = "Garrison Division" }
	}
	if = {
		limit = { has_template = "Militia Division" }
		delete_unit_template_and_units = { division_template = "Militia Division" }
	}
	if = {
		limit = { has_template = "Police Division" }
		delete_unit_template_and_units = { division_template = "Police Division" }
	}
	if = {
		limit = { has_template = "Cavalry Division" }
		delete_unit_template_and_units = { division_template = "Cavalry Division" }
	}
	if = {
		limit = { has_template = "Heavy Armour Division" }
		delete_unit_template_and_units = { division_template = "Heavy Armour Division" }
	}
	if = {
		limit = { has_template = "Marines" }
		delete_unit_template_and_units = { division_template = "Marines" }
	}
	if = {
		limit = { has_template = "Mountaineer-Division" }
		delete_unit_template_and_units = { division_template = "Mountaineer-Division" }
	}
	if = {
		limit = { has_template = "Paratroopers" }
		delete_unit_template_and_units = { division_template = "Paratroopers" }
	}
}

remove_claim_by_ROOT_and_add_core_of_ROOT = {
	if = {
		limit = { is_claimed_by = ROOT }
		remove_claim_by = ROOT
	}
	if = {
		limit = { NOT = { is_core_of = ROOT } }
		add_core_of = ROOT
	}
}

remove_cores_of_dead_tags = {
	hidden_effect = {
		for_each_loop = {
			array = global.china_tags_array
			var:v = {
				if = {
					limit = { exists = no }
					for_each_loop = {
						array = ROOT.owned_states
						var:v = {
							remove_claim_by = PREV
							remove_core_of = PREV
						}
					}
				}
			}
		}
	}
}

save_faction_into_array = {
	every_other_country = {
		limit = {
			is_in_faction_with = ROOT
			NOT = { tag = ROOT }
		}
		add_to_array = { ROOT.chinese_faction_members = THIS }
	}
	set_country_flag = was_chinese_faction_leader
	dismantle_faction = yes
}

increase_army_reform_level = {
	if = {
		limit = { has_idea = china_inadequate_army_1 }
		custom_effect_tooltip = china_army_reform_effect
		hidden_effect = {
			swap_ideas = {
				remove_idea = china_inadequate_army_1
				add_idea = china_inadequate_army_2
			}
		}
		set_variable = { china_army_reform_cost = 100 }
	}
	else_if = {
		limit = { has_idea = china_inadequate_army_2 }
		custom_effect_tooltip = china_army_reform_effect
		hidden_effect = {
			swap_ideas = {
				remove_idea = china_inadequate_army_2
				add_idea = china_inadequate_army_3
			}
		}
		set_variable = { china_army_reform_cost = 50 }
	}
	else_if = {
		limit = { has_idea = china_inadequate_army_3 }
		custom_effect_tooltip = china_army_reform_effect
		hidden_effect = {
			swap_ideas = {
				remove_idea = china_inadequate_army_3
				add_idea = china_inadequate_army_4
			}
		}
		set_variable = { china_army_reform_cost = 100 }
	}
	else_if = {
		limit = { has_idea = china_inadequate_army_4 }
		custom_effect_tooltip = china_army_reform_effect
		hidden_effect = {
			swap_ideas = {
				remove_idea = china_inadequate_army_4
				add_idea = china_inadequate_army_5
			}
		}
		set_variable = { china_army_reform_cost = 150 }
	}
	else_if = {
		limit = { has_idea = china_inadequate_army_5 }
		custom_effect_tooltip = china_army_reform_effect_complete
		hidden_effect = {
			remove_ideas = china_inadequate_army_5
		}
	}
}

increase_japanese_resistance_level_major = {
	if = {
		limit = {
			NOT = { has_variable = japanese_resistance_level }
		}
		set_variable = { japanese_resistance_level = 0.05 }
	}
	else = {
		add_to_variable = { japanese_resistance_level = 0.05 }
	}
}

increase_japanese_resistance_level_minor = {
	if = {
		limit = {
			NOT = { has_variable = japanese_resistance_level }
		}
		set_variable = { japanese_resistance_level = 0.025 }
	}
	else = {
		add_to_variable = { japanese_resistance_level = 0.025 }
	}
}

decrease_japanese_war_willingness = {
	if = {
		limit = { has_war_support > 0 }
		add_war_support = -0.1
	}
	else = {
		add_stability = -0.05
	}
}

central_government_flees_to_redoubt = {
	set_global_flag = china_central_government_flees
	set_country_flag = is_national_redoubt
	hidden_effect = {
		get_current_government_type = yes
		meta_effect = {
			text = {
				set_party_name = {
					ideology = [IDEOLOGY_TAG]
					name = "Central Government"
					long_name = "The Central Government"
				}
				set_politics = {
					ruling_party = [IDEOLOGY_TAG]
					elections_allowed = no
				}
				create_country_leader = {
					name = "[LEADER_TAG]"
					desc = ""
					picture = "[PORTRAIT_TAG]"
					expire = "1965.1.1"
					ideology = [IDEOLOGY_SUBTYPE_TAG]
				}
				set_cosmetic_tag = [COSMETIC_TAG]
			}
			IDEOLOGY_TAG = "[current_china_leader.GetRulingIdeologyId]"
			IDEOLOGY_SUBTYPE_TAG = "[current_china_leader.GetRulingIdeologySubtype]"
			LEADER_TAG = "[current_china_leader.GetLeader]"
			PORTRAIT_TAG = "[current_china_leader.GetChineseLeaderPortrait]"
			COSMETIC_TAG = "[current_china_leader.GetRedoubtCosmeticTag]"
		}
	}
}
central_government_returns = {
	clr_global_flag = china_central_government_flees
	clr_country_flag = is_national_redoubt
	hidden_effect = {
		kill_country_leader = yes
		drop_cosmetic_tag = yes
		meta_effect = {
			text = {
				set_party_name = {
					ideology = [IDEOLOGY_TAG]
					name = [PARTY_NAME_TAG]
					long_name = [LONG_NAME_TAG]
				}
			}
			IDEOLOGY_TAG = "[This.GetRulingIdeologyId]"
			PARTY_NAME_TAG = "[This.GetTag]_[This.GetRulingIdeologyId]_party"
			LONG_NAME_TAG = "[This.GetTag]_[This.GetRulingIdeologyId]_party_long"
		}
		restore_previous_government_type = yes
	}
}
