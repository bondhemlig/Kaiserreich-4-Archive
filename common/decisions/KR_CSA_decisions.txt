###########################################
# Combined Syndicates of America
# Decisions by Herkles
###########################################

CSA_international_decisions = {# Foreign Policy Stuff
	CSA_join_international = {# join the international
		icon = generic_research
		allowed = { original_tag = CSA }
		available = {
			OR = {
				has_war = no
				custom_trigger_tooltip = {
					tooltip = CSA_same_wars_as_Intl
					has_war = yes
					any_enemy_country = {
						OR = {
							has_war_with = FRA
							has_war_with = ENG
						}
					}
				}
			}
		}
		visible = {
			is_in_faction = no
			is_subject = no
			OR = {
				FRA = {
					exists = yes
					has_capitulated = no
					has_socialist_government = yes
					is_faction_leader = yes
					NOT = { has_war_with = CSA }
				}
				ENG = {
					exists = yes
					has_capitulated = no
					has_socialist_government = yes
					is_faction_leader = yes
					NOT = { has_war_with = CSA }
				}
			}
		}
		fire_only_once = yes
		cost = 50
		ai_will_do = {
			factor = 10
			modifier = {
				factor = 0
				FRA = {
					is_faction_leader = yes
					has_socialist_government = yes
					surrender_progress > 0.30
				}
			}
			modifier = {
				factor = 0
				ENG = {
					is_faction_leader = yes
					has_socialist_government = yes
					surrender_progress > 0.30
				}
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision CSA_join_international"
			random_country = {
				limit = {
					OR = {
						tag = ENG
						tag = FRA
					}
					exists = yes
					has_capitulated = no
					has_socialist_government = yes
					is_faction_leader = yes
					NOT = { has_war_with = CSA }
				}
				country_event = { id = csa.101 days = 1 }
			}
		}
	}
	
	CSA_Join_Phalanstere = {
		icon = generic_research
		allowed = { original_tag = CSA }
		available = {
			is_in_faction_with = FRA
		}
		visible = {
			is_in_faction_with = FRA
			has_global_flag = scientific_phalanstere
		}
		fire_only_once = yes
		cost = 25
		ai_will_do = {
			factor = 10
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision CSA_Join_Phalanstere"
			add_to_tech_sharing_group = phalanstere_research
		}
	}
	
	CSA_protect_hawaii = {# Protect Hawaii
		icon = generic_research
		allowed = { original_tag = CSA }
		available = {
			is_subject = no
			NOT = { is_in_faction_with = HAW }
		}
		visible = {
			country_exists = HAW
			378 = { is_owned_and_controlled_by = CSA }
			NOT = { is_in_faction_with = HAW }
			HAW = {
				has_country_flag = HAW_revolution_commune_declared
				has_socialist_government = yes
				is_subject = no
				has_war = no
			}
		}
		fire_only_once = yes
		cost = 50
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				has_war = yes
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision CSA_protect_hawaii"
			HAW = { country_event = { id = csa.103 days = 1 } }
		}
	}
	
	CSA_protect_philippines = {# join the Philippines
		icon = generic_research
		allowed = { original_tag = CSA }
		available = {
			is_subject = no
			NOT = { is_in_faction_with = "PHI" }
		}
		visible = {
			country_exists = "PHI"
			is_subject = no
			378 = { is_owned_and_controlled_by = CSA }
			"PHI" = {
				has_socialist_government = yes
				is_subject = no
				has_war = no
			}
		}
		fire_only_once = yes
		cost = 50
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				has_war = yes
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision CSA_protect_philippines"
			"PHI" = { country_event = { id = csa.104 days = 1 } }
		}
	}
}

CSA_international_industry_decisions = {# getting allies for America
	CSA_international_industry_program_descions = {
		icon = generic_research
		allowed = { original_tag = CSA }
		available = {
			has_global_flag = scientific_phalanstere
		}
		visible = {
			ROOT_is_in_international = yes
			has_global_flag = scientific_phalanstere
		}
		fire_only_once = yes
		cost = 50
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision CSA_international_industry_program_descions"
			set_country_flag = CSA_international_industry_program_flag
		}
	}
	
	CSA_develop_ally = {
		icon = decision_category_generic_industry
		allowed = { original_tag = CSA }
		
		available = {
			FROM = { controls_all_owned_states = yes }
		}
		
		visible = {
			has_country_flag = CSA_international_industry_program_flag
		}
		
		target_trigger = {
			FROM = {
				is_in_faction_with = CSA
				NOT = { tag = CAN }
				OR = {
					is_in_north_america = yes
					is_in_south_america = yes
				}
				NOT = { has_country_flag = CSA_received_industrial_aid }
			}
		}
		
		fire_only_once = no
		cost = 25
		days_remove = 60
		
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 5
				OR = {
					tag = MEX
					tag = BRA
				}
			}
		}
		
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision USA_develop_ally target: [From.GetName]"
			FROM = { set_country_flag = CSA_received_industrial_aid }
			reverse_add_opinion_modifier = { target = FROM modifier = ITA_likes_govt }
		}
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove USA_develop_ally target: [From.GetName]"
			custom_effect_tooltip = USA_build_two_infra
			hidden_effect = {
				FROM = { country_event = ustates.252 }
			}
		}
	}
}

CSA_expanding_the_revolution_decisions = {# Expanding the Revolution
	CSA_finish_the_revolution1 = {# Going after the PSA
		icon = generic_prepare_civil_war
		allowed = {	original_tag = CSA	}
		available = {
			is_subject = no
			OR = {
				has_completed_focus = CSA_american_commonwealth
				has_completed_focus = CSA_usas
			}
		}
		visible = {
			has_global_flag = USA_civil_war_over_flag
			is_subject = no
			country_exists = CAL
			NOT = {
				has_war_with = CAL
				is_in_faction_with = CAL
			}
		}

		fire_only_once = yes
		cost = 60
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 50
				is_in_faction = yes
			}
			modifier = {
				factor = 0
				has_war = yes
			}
		}

		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision CSA_finish_the_revolution1"
			set_country_flag = CSA_prepare_to_finish_the_revolution_flag
			every_state = {
				limit = {
					is_owned_by = CAL
					is_core_of = CAL
					NOT = {
						is_core_of = CSA
						is_claimed_by = CSA
					}
				}
				add_claim_by = CSA
			}
			if = {
				limit = { CAL = { is_in_faction = yes } }
				every_country = {
					limit = { is_in_faction_with = CAL }
					reverse_add_opinion_modifier = { target = USA modifier = embargo }
				}
				else = {
					add_opinion_modifier = { target = CAL modifier = embargo }
				}
			}
		}
	}
	
	CSA_finish_the_revolution2 = {# go to war with the PSA
		icon = generic_prepare_civil_war
		allowed = {	original_tag = CSA	}
		available = {
			is_subject = no
			has_war = no
			CAL = { is_valid_war_target = yes }
		}
		visible = {
			has_global_flag = USA_civil_war_over_flag
			has_country_flag = CSA_prepare_to_finish_the_revolution_flag
			country_exists = CAL
			NOT = {
				has_war_with = CAL
				is_in_faction_with = CAL
			}
		}

		fire_only_once = yes
		cost = 60
		modifier = {  }
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 50
				is_in_faction = yes
			}
			modifier = {
				factor = 0
				strength_ratio = { tag = CAL ratio < 1.50 }
			}
			modifier = {
				factor = 0
				CAL = {
					is_in_faction = yes
					any_allied_country = {
						strength_ratio = { tag = CSA ratio > 2.0 }
					}
				}
			}
		}
		war_with_on_complete = CAL
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision CSA_finish_the_revolution2"
			declare_war_on = {	type = annex_everything	target = CAL }
		}
	}
	
	CSA_expand_revolution = {
		icon = generic_prepare_civil_war
		allowed = { original_tag = CSA }
		available = {
			has_war = no
			is_subject = no
		}
		visible = {
			NOT = { country_exists = CAL }
			OR = {
				has_completed_focus = CSA_the_revolution_continues
				has_completed_focus = CSA_purge_reactionaries
			}
		}
		target_trigger = {
			FROM = {
				OR = {
					is_in_north_america = yes
					is_in_south_america = yes
					tag = GER
					tag = "PHI"
				}
				OR = {
					is_neighbor_of = ROOT
					any_neighbor_country = { is_in_faction_with = ROOT }
					any_neighbor_country = { is_subject_of = ROOT }
					tag = CUB
					tag = DOM
					tag = HAI
					tag = CAF
					tag = COL
					tag = VEN
					tag = GER
					tag = "PHI"
				}
				exists = yes
				is_valid_war_target = yes
				not_has_socialist_government = yes
				OR = {
					NOT = { tag = MEX }
					NOT = { has_government = social_democrat }
				}
				OR = {
					NOT = { tag = ARG }
					NOT = { country_exists = FOP }
				}
			}
		}
		
		fire_only_once = no
		cost = 60
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 5
				FROM = {
					OR = {
						tag = CAN
						tag = MEX
					}
				}
			}
			modifier = {
				factor = 2
				FROM = { is_in_north_america = yes }
			}
			modifier = {
				factor = 0
				NOT = {
					is_neighbor_of = FROM
					has_navy_size = { size > 100 type = convoy }
				}
			}
			modifier = {
				factor = 0
				has_army_manpower = { size < 250000 }
			}
			# don't attack a faction leader Canada unless we're much stronger or they're at war
			modifier = {
				factor = 0
				FROM = { tag = CAN }
				CAN = { is_in_faction = yes }
				NOT = {
					strength_ratio = { tag = CAN ratio < 4.0 }
					CAN = { has_war_with = FRA }
					CAN = { has_war_with = ENG }
					CAN = { has_war_with = GER }
				}
			}
			# don't attack a non-neighboring target we can't overwhelm if Canada still exists
			modifier = {
				factor = 0
				FROM = {
					NOT = { tag = CAN }
					NOT = {
						is_neighbor_of = CSA
						any_neighbor_country = { is_in_faction_with = ROOT }
						any_neighbor_country = { is_subject_of = ROOT }
						strength_ratio = { tag = CSA ratio < 0.1 }
					}
				}
				CAN = {
					exists = yes
					not_has_socialist_government = yes
					is_subject = no
				}
			}
			# don't attack Germany unless we're in a faction, France no longer exists, or it's losing a war
			modifier = {
				factor = 0
				FROM = { tag = GER }
				NOT = {
					is_in_faction = yes
					NOT = { country_exists = FRA }
					GER = { surrender_progress > 0.20 }
				}
			}
			modifier = {
				factor = 0
				FROM = {
					is_in_faction = no
					strength_ratio = { tag = CSA ratio > 0.5 }
				}
			}
			modifier = {
				factor = 0
				FROM = {
					is_in_faction = yes
					OR = {
						strength_ratio = { tag = CSA ratio > 0.5 }
						any_allied_country = {
							is_faction_leader = yes
							strength_ratio = { tag = CSA ratio > 1.0 }
						}
					}
				}
			}
		}
		complete_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision CSA_expand_revolution target: [From.GetName]"
			declare_war_on = {	type = annex_everything	target = FROM }
		}
	}
}

CSA_deal_with_terrorists_decisions = {# Dealing with reactionary terrorists
	CSA_destroy_longist_decision = {# Destroy Longists
		icon = GFX_industrial_capacity_icon
		allowed = { original_tag = CSA }
		available = {
		}
		visible = {
			has_completed_focus = CSA_destroy_jim_crow
			OR = {
				has_idea = USA_longist_resistance1
				has_idea = USA_longist_resistance2
				has_idea = USA_longist_resistance3
				has_idea = USA_longist_resistance4
			}
		}

		cost = 20

		days_re_enable = 10
		days_remove = 100

		ai_will_do = { factor = 100 }
		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove CSA_destroy_longist_decision"
			if = {
				limit = { has_idea = USA_longist_resistance1 }
				swap_ideas = {
					remove_idea = USA_longist_resistance1
					add_idea = USA_longist_resistance2
				}
			}
			else_if = {
				limit = { has_idea = USA_longist_resistance2 }
				swap_ideas = {
					remove_idea = USA_longist_resistance2
					add_idea = USA_longist_resistance3
				}
			}
			else_if = {
				limit = { has_idea = USA_longist_resistance3 }
				swap_ideas = {
					remove_idea = USA_longist_resistance3
					add_idea = USA_longist_resistance4
				}
			}
			else_if = {
				limit = { has_idea = USA_longist_resistance4 }
				remove_ideas = USA_longist_resistance4
			}
		}
	}
	
	CSA_destroy_federalist_decision = {# Destroy capitalists
		icon = GFX_industrial_capacity_icon
		allowed = { original_tag = CSA }
		available = {
		}
		visible = {
			OR = {
				has_idea = USA_federalist_resistance1
				has_idea = USA_federalist_resistance2
				has_idea = USA_federalist_resistance3
				has_idea = USA_federalist_resistance4
			}
			has_completed_focus = CSA_transformitive_justice
		}

		cost = 20

		days_re_enable = 10
		days_remove = 100

		ai_will_do = {
			factor = 100
		}

		remove_effect = {
			log = "[GetDateText]: [Root.GetName]: Decision remove CSA_destroy_federalist_decision"
			if = {
				limit = { has_idea = USA_federalist_resistance1 }
				swap_ideas = {
					remove_idea = USA_federalist_resistance1
					add_idea = USA_federalist_resistance2
				}
			}
			else_if = {
				limit = { has_idea = USA_federalist_resistance2 }
				swap_ideas = {
					remove_idea = USA_federalist_resistance2
					add_idea = USA_federalist_resistance3
				}
			}
			else_if = {
				limit = { has_idea = USA_federalist_resistance3 }
				swap_ideas = {
					remove_idea = USA_federalist_resistance3
					add_idea = USA_federalist_resistance4
				}
			}
			else_if = {
				limit = { has_idea = USA_federalist_resistance4 }
				remove_ideas = USA_federalist_resistance4
			}
		}
	}
}

